!function(t,i,e){function n(i){var n={current:!1,loaded:0,dimensions:!1,currentImageDim:{},controlPosition:0,clipAreaRatio:!1,$clipedImage:!1,$control:!1,init:function(){var r=i.find("img").slice(0,2),a=e("body");o.maxWidth=i.attr("data-maxWidth")>0?i.attr("data-maxWidth"):o.maxWidth,o.resize=i.attr("data-resize")?parseInt(i.attr("data-resize")):o.resize,n.current=e(o.layout.container),n.current.bind("prebuild",function(){n.dimensions=n.getImageRealSize(r.first().get(0)),i.css("display","none"),o.width||(o.width=n.current.width()),n.current.insertBefore(i),n.current.css({height:o.width/n.dimensions.width*n.dimensions.height})}),n.current.bind("loaded",function(){function d(t){n.stopAnimation(n.$control),n.stopAnimation(n.$clipedImage);var i=t.pageY||t.originalEvent.touches[0].pageY,e=t.pageX||t.originalEvent.touches[0].pageX,o=!0,r=0;a.bind("mousemove.diff touchmove.diff",function(t){var a=t.pageX||t.originalEvent.touches[0].pageX,d=t.pageY||t.originalEvent.touches[0].pageY;return Math.abs(d-i)>Math.abs(a-e)&&1>r?(o=!1,!0):o?(n.controlPosition=a-s.left,n.clipAreaRatio=n.controlPosition/n.currentImageDim.width,n.move(n.controlPosition),r+=1,!1):void 0})}var c,s,l={};l.before=r.first().attr("data-title")||o.titles.before,l.after=r.last().attr("data-title")||o.titles.after,r.each(function(t){var i=e(o.layout.item),r=e(o.layout.title);i.append(e(this)),l.before&&1>t&&(r.addClass("b-diff__title_before"),i.append(r.text(l.after))),l.after&&t>0&&(r.addClass("b-diff__title_after"),i.append(r.text(l.before))),n.current.append(i)}),n.$control=e(o.layout.control),n.$clipedImage=n.current.find(".b-diff__item:last"),n.current.append(n.$control),s=n.current.offset(),n.resizeItems(o.width),c=n.$control.width(),n.controlPosition=n.currentImageDim.width/2-c/2,n.clipAreaRatio=n.controlPosition/n.currentImageDim.width,n.move(n.controlPosition),i.remove(),o.resize&&e(t).resize(function(){n.stopAnimation(n.$control),n.stopAnimation(n.$clipedImage),n.resizeItems(),n.controlPosition=n.clipAreaRatio*n.currentImageDim.width,n.move(n.controlPosition),s=n.current.offset()}),n.current.bind("click",function(t){var i=t.pageX||t.originalEvent.touches[0].pageX;n.controlPosition=i-s.left,n.clipAreaRatio=n.controlPosition/n.currentImageDim.width,n.animateItems(n.controlPosition),console.log("click")}),n.current.bind("mousedown.diff",function(t){return 1==t.which?(d(t),!1):void 0}),n.current.bind("touchstart.diff",d),a.bind("mouseup.diff touchend.diff mouseleave.diff touchleave.diff",function(){a.unbind("mousemove.diff touchmove.diff")}),r.bind("dragstart",function(){return!1})}),r.each(function(){this.complete?(n.loaded+=1,1===n.loaded&&n.current.trigger("prebuild"),n.loaded==r.length&&n.current.trigger("loaded")):e(this).load(function(){n.loaded+=1,1===n.loaded&&n.current.trigger("prebuild"),n.loaded==r.length&&n.current.trigger("loaded")})})},getImageRealSize:function(t){return{width:t.naturalWidth,height:t.naturalHeight,ratio:t.naturalWidth/t.naturalHeight}},setClipArea:function(t){n.$clipedImage.css("clip","rect(0, "+t+"px,"+n.currentImageDim.height+"px, 0)")},moveControl:function(t){n.$control.css({left:t})},move:function(t){var i=n.$control.width();0>=t?t=0:t>=n.currentImageDim.width-i&&(t=n.currentImageDim.width-i),n.moveControl(t-o.controlSpace),n.setClipArea(t)},resizeItems:function(t){var i,e=t||n.current.width();n.dimensions.width<=e&&(e=n.dimensions.width),"auto"!=o.maxWidth&&(e=o.maxWidth<e?o.maxWidth:e),i=e/n.dimensions.width,n.currentImageDim.width=i*n.dimensions.width,n.currentImageDim.height=i*n.dimensions.height,n.current.find(".b-diff__item").css({width:n.currentImageDim.width,height:n.currentImageDim.height}),n.current.css("height",n.currentImageDim.height),n.$control.css("height",n.currentImageDim.height)},animateItems:function(t){n.$control.css({"-webkit-transition":"left .3s ease-in-out",transition:"left .3s ease-in-out"}),n.$clipedImage.css({"-webkit-transition":"all .3s ease-in-out",transition:"all .3s ease-in-out"}),n.move(t)},stopAnimation:function(t){t.css({"-webkit-transition":"",transition:""})}};n.init()}var o={controlSpace:18,maxWidth:"auto",width:!1,resize:!0,titles:{before:"",after:""},layout:{container:'<div class="b-diff"></div>',item:'<div class="b-diff__item"></div>',control:'<div class="b-diff__control"><div class="b-diff__line"></div><div class="b-diff__arrow b-diff__arrow_left"></div><div class="b-diff__arrow b-diff__arrow_right"></div></div>',title:'<div class="b-diff__title"></div>'}};e.fn.simpleImageDiff=function(t){e.extend(o,t||{}),this.each(function(){n(e(this))})}}(window,document,jQuery);